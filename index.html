<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>CTI Time Clock</title>
    <style>
      :root{
        --bg:#f5f5f5;
        --panel:#fff;
        --accent:#0b6efd;
        --muted:#666;
      }
      html,body{
        height:100%;
        margin:0;
        font-family:system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;
        background:var(--bg);
        color:#111;
      }

      /* ðŸ‘‡ Hide header & notice so only the main timeclock page shows */
      header{
        display:none !important;
      }
      .notice{
        display:none !important;
      }

      .logo{
        display:flex;
        align-items:center;
        gap:12px;
        flex:1 1 auto;
      }
      .logo img{
        max-height:52px;
        display:block;
      }
      .controls{
        display:flex;
        gap:8px;
        align-items:center;
        flex:0 0 auto;
      }
      input[type="text"]{
        padding:8px 10px;
        border-radius:8px;
        border:1px solid #ddd;
        min-width:220px;
        font-size:14px;
      }
      button{
        padding:8px 10px;
        border-radius:8px;
        border:1px solid rgba(0,0,0,0.08);
        background:var(--accent);
        color:white;
        cursor:pointer;
        font-weight:600;
      }
      button.ghost{
        background:transparent;
        color:var(--accent);
        border:1px solid rgba(11,110,253,0.12);
      }

      /* ðŸ‘‡ Make the iframe fill the whole screen */
      main{
        height:100vh;
        margin:0;
        padding:0;
      }
      .frame-wrap{
        height:100%;
      }
      iframe{
        width:100%;
        height:100%;
        border:0;
        display:block;
        background:white;
      }

      .small{
        font-size:13px;
        color:var(--muted);
        margin-left:8px;
      }
      @media (max-width:640px){
        header{
          flex-direction:column;
          align-items:stretch;
          gap:8px;
        }
        .controls{
          justify-content:space-between;
        }
        input[type="text"]{min-width:140px; width:100%;}
      }
    </style>
  </head>
  <body>
    <header>
      <div class="logo">
        <img src="logo.png" alt="Company Logo" onerror="this.style.display='none'">
        <div>
          <div style="font-weight:700">CTI Time Clock</div>
          <div class="small">Embedded OpenTimeClock page</div>
        </div>
      </div>

      <div class="controls" aria-hidden="false">
        <label for="company" class="small" style="display:none">Company</label>
        <input id="company" type="text" placeholder="Company name (e.g. Acme Inc.)" />
        <button id="go">Load</button>
        <button id="open" class="ghost" title="Open in OpenTimeClock">Open in site</button>
      </div>
    </header>

    <main>
      <div id="notice" class="notice" role="status"></div>
      <div class="frame-wrap">
        <iframe id="timeframe"
          title="CTI Time Clock iframe"
          src=""
          allow="geolocation; camera; microphone; clipboard-read; clipboard-write">
        </iframe>
      </div>
    </main>

    <script>
      (function(){
        // ðŸ‘‡ Base URL now correctly ends with companyname=
        const BASE = "https://www.opentimeclock.com/app.html?page=company&companyname=";

        // ðŸ‘‡ Default company that will auto-load
        const DEFAULT_COMPANY = "TGS Carwash"; // change this to your real OTC company name if needed

        const companyInput = document.getElementById("company");
        const goBtn = document.getElementById("go");
        const openBtn = document.getElementById("open");
        const iframe = document.getElementById("timeframe");
        const notice = document.getElementById("notice");

        function q(name){
          const params = new URLSearchParams(window.location.search);
          return params.get(name);
        }

        function saveName(name){
          try{ localStorage.setItem("otc_company", name); }catch(e){}
        }
        function loadSaved(){
          try{return localStorage.getItem("otc_company")||"";}catch(e){return "";}
        }

        function buildSrc(name){
          return BASE + encodeURIComponent(name || "");
        }

        function setIframeFor(name){
          const src = buildSrc(name || "");
          iframe.src = src;
          if (openBtn) {
            openBtn.dataset.href = src;
          }
        }

        // ðŸ‘‡ Auto-load default company (or query/localStorage override)
        const initial = q("company") || loadSaved() || DEFAULT_COMPANY;

        if (companyInput) {
          companyInput.value = initial;
        }
        saveName(initial);
        setIframeFor(initial);

        // Handlers (not visible, but kept for flexibility)
        if (goBtn) {
          goBtn.addEventListener("click", () => {
            const val = (companyInput.value || "").trim();
            if(!val) { return; }
            saveName(val);
            setIframeFor(val);
          });
        }

        if (companyInput) {
          companyInput.addEventListener("keydown", (e) => {
            if(e.key === "Enter" && goBtn) { goBtn.click(); }
          });
        }

        if (openBtn) {
          openBtn.addEventListener("click", (e) => {
            const href = openBtn.dataset.href || buildSrc((companyInput.value || "").trim());
            if(!href) return;
            window.open(href, "_blank", "noreferrer");
          });
        }

        // Keep this simple: if iframe doesn't load in a few seconds, we won't show any notice
        // because notice is hidden for kiosk use.
      })();
    </script>
  </body>
</html>
